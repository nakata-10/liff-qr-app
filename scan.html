<!-- scan.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>QRスキャン受け口</title>
  <script src="config.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', async () => {
      const params = new URLSearchParams(location.search);
      const codeText = params.get('code');
      if (!codeText) {
        document.body.textContent = 'QR 情報が見つかりませんでした';
        return;
      }

      // LIFF 初期化（任意・匿名 API 呼び出しなら不要）
      // await liff.init({ liffId: window.APP_CONFIG.LIFF_ID });

      // API エンドポイント
      const url = window.APP_CONFIG.AZURE_FUNCTION_URL;
      // 認証不要なら Authorization ヘッダも不要
      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: 'anonymous',   // 認証ありにするなら LIFF 絡みで置き換え
            points: 10,
            scanInfo: { qrText: codeText, timestamp: new Date().toISOString() }
          })
        });
        const json = await res.json();
        document.body.textContent = json.message || json.error;
      } catch (err) {
        document.body.textContent = '通信エラー: ' + err.message;
      }
    });
  </script>
</head>
<body>
  <p>処理中…</p>
</body>
</html>
